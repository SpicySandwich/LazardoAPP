package com.client.LazardoClient.DAO;

import com.client.LazardoClient.Model.BuyerClientDetails;
import com.client.LazardoClient.Model.SellerClientDetails;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Update;

@Mapper
public interface ClientDetailsChanges {
	
	final String BUYER_DETAIL_UPDATE = "UPDATE tbclientdetails  cd "
			+ "JOIN( "
			+ "SELECT  "
			+ "cd2.role AS clientrole,  "
			+ "cd2.client_id AS clientid, "
			+ "cd2.client_firstname AS firstname, "
			+ "cd2.client_lastname AS lastname, "
			+ "cd2. client_email AS email "
			+ "FROM tbclientlogin cl2 "
			+ "LEFT JOIN tbclientdetails cd2 "
			+ "ON cl2.client_login_id = cd2.client_id "
			+ "WHERE cl2.client_username = #{loginUsername} AND cd2.role = 1 "
			+ ") clientinfo "
			+ "SET  "
			+ "cd. client_email = if(cd. client_email =! NULL, cd. client_email = #{email}, cd. client_email) , "
			+ "cd.client_firstname = if(cd.client_firstname != NULL, cd.client_firstname = #{firstname}, cd.client_firstname), "
			+ "cd.client_lastname = if(cd.client_lastname != NULL, cd.client_lastname = #{lastname}, cd.client_lastname) "
			+ "WHERE cd.client_id = clientinfo.clientid AND cd.role = clientinfo.clientrole;";
	
	final String SELLER_DETAIL_UPDATE = "UPDATE tbclientdetails  cd "
			+ "JOIN( "
			+ "SELECT cd2.role AS clientrole, cd2.client_id AS clientid "
			+ "FROM tbclientlogin cl2 "
			+ "LEFT JOIN tbclientdetails cd2 "
			+ "ON cl2.client_login_id = cd2.client_id "
			+ "WHERE cl2.client_username = #{loginUsername} AND cd2.role = 2 "
			+ ") clientinfo "
			+ "SET cd. client_email = #{email}, cd.client_firstname =  #{firstname}, cd.client_lastname =  #{lastname} "
			+ "WHERE cd.client_id = clientinfo.clientid AND cd.role = clientinfo.clientrole;";
	
	@Update(BUYER_DETAIL_UPDATE )
	Integer changeBuyerDetails(BuyerClientDetails buyerClientDetails);
	
	@Update(SELLER_DETAIL_UPDATE)
	Integer changesSellerDetails(@Param("sellerClientDetails") SellerClientDetails sellerClientDetails);

}
