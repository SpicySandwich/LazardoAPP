package com.client.LazardoClient.DAO;

import com.client.LazardoClient.Model.SellerChangesProduct;
import com.client.LazardoClient.Model.SellerProduct;

import org.apache.ibatis.annotations.Delete;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Update;

@Mapper
public interface SellerDeleteUpdateProductRepo {
	
	final String DELETE_PRODUCT_SELLER = "DELETE FROM tblazardoproduct "
			+ "WHERE product_id = ( "
			+ "SELECT id FROM( "
			+ "SELECT lp.product_id AS id "
			+ "FROM tblazardoproduct lp "
			+ "LEFT JOIN tbclientdetails cd "
			+ "ON lp.sellerid = cd.client_id "
			+ "LEFT JOIN tbpurchasedetails pd "
			+ "ON lp.product_id = pd.client_purchase_id "
			+ "WHERE cd.client_email = #{sellerEmail}  AND cd.role = 2 AND product_id = #{productId} AND pd.client_purchase_id IS NULL OR pd.client_purchase_id ='' "
			+ ") AS sellerdeleteprodct); "
			+ "";
	
	final String UPDATE_PRODUCT_SELLER2 = "UPDATE tblazardoproduct lp, tbclientdetails cd\r\n"
			+ "JOIN(\r\n"
			+ "SELECT \r\n"
			+ "lp2.sellerid AS sellid, \r\n"
			+ "cd2.client_email AS selleremail, \r\n"
			+ "cd2.role AS sellerrole, \r\n"
			+ "lp2.product_id AS productid,\r\n"
			+ "lp2.product_brand AS productbrand,\r\n"
			+ "lp2.product_name AS productname,\r\n"
			+ "lp2.product_price AS productprice,\r\n"
			+ "lp2.product_comment AS productcomment\r\n"
			+ "FROM tbclientdetails cd2\r\n"
			+ "LEFT JOIN tblazardoproduct lp2\r\n"
			+ "ON cd2.client_id = lp2.sellerid\r\n"
			+ "WHERE cd2.client_email = 'conseller3@gmail.com' AND cd2.role = 2 AND lp2.product_id = 8\r\n"
			+ ") info\r\n"
			+ "SET lp.product_brand =  COALESCE('Skippy Update2',info.productbrand),\r\n"
			+ " lp.product_name =  COALESCE('Skippy Natural2',info.productname),\r\n"
			+ " lp.product_price =  COALESCE(10.42,info.productprice), \r\n"
			+ " lp.product_comment =  COALESCE(null,info.productcomment)\r\n"
			+ "WHERE lp.product_id = info.productid AND lp.sellerid = info.sellid AND cd.client_email = info.selleremail AND cd.role = info.sellerrole;";
	
	final String UPDATE_PRODUCT_SELLER = "UPDATE tblazardoproduct lp, tbclientdetails cd "
			+ "JOIN( "
			+ "SELECT lp2.sellerid AS sellid, cd2.client_email AS selleremail, cd2.role AS sellerrole, lp2.product_id AS productid "
			+ "FROM tbclientdetails cd2 "
			+ "LEFT JOIN tblazardoproduct lp2 "
			+ "ON cd2.client_id = lp2.sellerid "
			+ "WHERE cd2.client_email = #{clientSellerEmail} AND cd2.role = 2 AND lp2.product_id = #{id} "
			+ ") info "
			+ "SET lp.product_brand = #{brand}, lp.product_name = #{name},lp.product_price = #{price}, lp.product_comment = #{comment} "
			+ "WHERE lp.product_id = info.productid AND lp.sellerid = info.sellid AND cd.client_email = info.selleremail AND cd.role = info.sellerrole;";
	
	@Delete(DELETE_PRODUCT_SELLER)
	public boolean deleteSellerProduct(SellerChangesProduct changesProduct);
	
	@Update(UPDATE_PRODUCT_SELLER)
	public boolean updateSellerProduct(SellerProduct product);

}
