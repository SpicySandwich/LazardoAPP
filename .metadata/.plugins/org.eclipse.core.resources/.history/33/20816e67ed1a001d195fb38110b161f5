package com.client.LazardoClient.DAO;

import com.client.LazardoClient.Model.AddBalance;
import com.client.LazardoClient.Model.TransferBalance;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Update;

@Mapper
public interface ClientBalance {
	
	final String ADD_BALANCE = "UPDATE tbclientdetails  cd "
													+ "JOIN ( "
													+ "SELECT cd2.money_balance AS currentbalance, cd2.client_email AS clientemail "
													+ "FROM tbclientdetails cd2 "
													+ "WHERE cd2.client_email = #{clientEmail} "
													+ ") balance "
													+ "SET cd.money_balance = balance.currentbalance + #{balance} "
													+ "WHERE cd.client_email = balance.clientemail; ";
	
	final String TRANSFER_BALANCE = "UPDATE tbclientdetails  cd "
			+ "JOIN( "
			+ "SELECT cd2.client_email AS clientEmail, cd2.money_balance - #{} AS transferbalance "
			+ "FROM tbclientlogin cl2 "
			+ "LEFT JOIN tbclientdetails cd2 "
			+ "ON cl2.client_login_id = cd2.client_id "
			+ "WHERE cd2.client_email  = #{senderEmail} "
			+ ") AS transfer "
			+ "SET cd.money_balance = if( transferbalance >= 0, transferbalance, cd.money_balance) "
			+ "WHERE cd.client_email  = transfer.clientEmail; "
			+ " "
			+ "UPDATE tbclientdetails  cd\r\n"
			+ "SET cd.money_balance = cd.money_balance + #{} "
			+ "WHERE cd.client_email  = #{};";
	
	@Update(ADD_BALANCE)
	boolean addBalance( AddBalance addBalance);
	
	@Update(TRANSFER_BALANCE)
	boolean transferBalance(TransferBalance transferBalance);

}
